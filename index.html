<html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<body>
<h1>Stardew Valley First Year Checklist</h1>
<p>This is a personal project. Hopefully, it will help users stay up to date on their first-year progress, assuming they use default bundles.</p>
<p>Please select your Stardew save file: 
<input type="file" id="file_select" /></p>

<output id="out"> </output>

<script>
window.onload = function() {
    if (!(window.File && window.FileReader)) {
		document.getElementById('out').innerHTML = '<span class="error">Fatal Error with API</span>';
		return;
	}

    function fileprocess(evt) {
		var file = evt.target.files[0];
		var saveRead = new FileReader();
        var output = "<h2>Results</h2>\n";

		saveRead.onload = function(e) {
            var output = document.getElementById('out').innerHTML;
            var xmlDoc = $.parseXML(e.target.result);
            
            var playerSave = {};

            playerSave.season = $(xmlDoc).find('currentSeason').html();
            playerSave.name = $(xmlDoc).find('player > name').text;
            playerSave.farmName = $(xmlDoc).find('player > farmName').html();
            playerSave.year = Number($(xmlDoc).find('year').text());
            output += '<h3>Summary</h3>\n';
            output += '<span class="result">Farmer ' + $(xmlDoc).find('player > name').text() + ' of '
				+ $(xmlDoc).find('player > farmName').text() + ' Farm</span><br />\n';
            output += '<span class="result">Hello, ' + playerSave.name + ' of ' + playerSave.farmName+ 'farm!</span><br />\n';

            // TODO: check if player is using remixed bundles (not supported with checklist)
            // TODO: parse bundle data
            // TODO: present data by season, state whether player is on track based on playerSave.season
            document.getElementById('out').innerHTML = output;
        };
        saveRead.readAsText(file);
        document.getElementById('out').innerHTML = output;
    }
    document.getElementById('file_select').addEventListener('change', fileprocess, false);
}
</script>

</body>
</html>